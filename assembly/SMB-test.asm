;SuperMarioBrothers TOM-test
;ROM made by: BILLPC2684
%TITLE ;SMB-TGR

Player0s:{
 0x00,0x00,0x01,0x11,0x11,0x00,0x00,0x00,
 0x00,0x00,0x11,0x11,0x11,0x11,0x10,0x00,
 0x00,0x00,0x33,0x32,0x23,0x20,0x00,0x00,
 0x00,0x03,0x23,0x22,0x23,0x22,0x20,0x00,
 0x00,0x03,0x23,0x32,0x22,0x32,0x22,0x00,
 0x00,0x03,0x32,0x22,0x23,0x33,0x30,0x00,
 0x00,0x00,0x02,0x22,0x22,0x22,0x00,0x00,
 0x00,0x00,0x33,0x13,0x33,0x00,0x00,0x00,
 0x00,0x03,0x33,0x13,0x31,0x33,0x30,0x00,
 0x00,0x33,0x33,0x11,0x11,0x33,0x33,0x00,
 0x00,0x22,0x31,0x21,0x12,0x13,0x22,0x00,
 0x00,0x22,0x21,0x11,0x11,0x12,0x22,0x00,
 0x00,0x22,0x11,0x11,0x11,0x11,0x22,0x00,
 0x00,0x00,0x11,0x10,0x01,0x11,0x00,0x00,
 0x00,0x03,0x33,0x00,0x00,0x33,0x30,0x00,
 0x00,0x33,0x33,0x00,0x00,0x33,0x33,0x00,
}
Player1s:{
 0x00,0x00,0x01,0x11,0x11,0x00,0x00,0x00,
 0x00,0x00,0x11,0x11,0x11,0x11,0x10,0x00,
 0x00,0x00,0x33,0x32,0x23,0x20,0x00,0x00,
 0x00,0x03,0x23,0x22,0x23,0x22,0x20,0x00,
 0x00,0x03,0x23,0x32,0x22,0x32,0x22,0x00,
 0x00,0x03,0x32,0x22,0x23,0x33,0x30,0x00,
 0x00,0x00,0x02,0x22,0x22,0x22,0x00,0x00,
 0x00,0x00,0x33,0x13,0x33,0x00,0x00,0x00,
 0x00,0x03,0x33,0x13,0x31,0x33,0x30,0x00,
 0x00,0x33,0x33,0x11,0x11,0x33,0x33,0x00,
 0x00,0x22,0x31,0x21,0x12,0x13,0x22,0x00,
 0x00,0x22,0x21,0x11,0x11,0x12,0x22,0x00,
 0x00,0x22,0x11,0x11,0x11,0x11,0x22,0x00,
 0x00,0x00,0x11,0x10,0x01,0x11,0x00,0x00,
 0x00,0x03,0x33,0x00,0x00,0x33,0x30,0x00,
 0x00,0x33,0x33,0x00,0x00,0x33,0x33,0x00,
}
Player2s:{
 0x00,0x00,0x01,0x11,0x11,0x00,0x00,0x00,
 0x00,0x00,0x11,0x11,0x11,0x11,0x10,0x00,
 0x00,0x00,0x33,0x32,0x23,0x20,0x00,0x00,
 0x00,0x03,0x23,0x22,0x23,0x22,0x20,0x00,
 0x00,0x03,0x23,0x32,0x22,0x32,0x22,0x00,
 0x00,0x03,0x32,0x22,0x23,0x33,0x30,0x00,
 0x00,0x00,0x02,0x22,0x22,0x22,0x00,0x00,
 0x00,0x00,0x33,0x13,0x33,0x00,0x00,0x00,
 0x00,0x03,0x33,0x13,0x31,0x33,0x30,0x00,
 0x00,0x33,0x33,0x11,0x11,0x33,0x33,0x00,
 0x00,0x22,0x31,0x21,0x12,0x13,0x22,0x00,
 0x00,0x22,0x21,0x11,0x11,0x12,0x22,0x00,
 0x00,0x22,0x11,0x11,0x11,0x11,0x22,0x00,
 0x00,0x00,0x11,0x10,0x01,0x11,0x00,0x00,
 0x00,0x03,0x33,0x00,0x00,0x33,0x30,0x00,
 0x00,0x33,0x33,0x00,0x00,0x33,0x33,0x00,
}
Player3s:{
 0x00,0x00,0x01,0x11,0x11,0x00,0x00,0x00,
 0x00,0x00,0x11,0x11,0x11,0x11,0x10,0x00,
 0x00,0x00,0x33,0x32,0x23,0x20,0x00,0x00,
 0x00,0x03,0x23,0x22,0x23,0x22,0x20,0x00,
 0x00,0x03,0x23,0x32,0x22,0x32,0x22,0x00,
 0x00,0x03,0x32,0x22,0x23,0x33,0x30,0x00,
 0x00,0x00,0x02,0x22,0x22,0x22,0x00,0x00,
 0x00,0x00,0x33,0x13,0x33,0x00,0x00,0x00,
 0x00,0x03,0x33,0x13,0x31,0x33,0x30,0x00,
 0x00,0x33,0x33,0x11,0x11,0x33,0x33,0x00,
 0x00,0x22,0x31,0x21,0x12,0x13,0x22,0x00,
 0x00,0x22,0x21,0x11,0x11,0x12,0x22,0x00,
 0x00,0x22,0x11,0x11,0x11,0x11,0x22,0x00,
 0x00,0x00,0x11,0x10,0x01,0x11,0x00,0x00,
 0x00,0x03,0x33,0x00,0x00,0x33,0x30,0x00,
 0x00,0x33,0x33,0x00,0x00,0x33,0x33,0x00,
}
;CP0: 177, 52, 37; 227,157, 37; 106,107,  4;
;CP1: 255,255,255; 227,157, 37;  58,132,  0;
;CP2: 247,214,164; 338,157, 37; 181, 49, 33;


drecv d,0x0,0x00 ;width
drecv h,0x0,0x01 ;height

mov f,0x0F
dsend f,0x0,0x02
dsend f,0x0,0x03
dsend f,0x0,0x04
mov f,0x01
dsend f,0x0,0x05

ploop0:
 cmpgt c,h
 jmp [script]
ploop1:
 cmpgt b,d
 jmp [preset_x]
 
 dsend b,0x0,0x00  ;set xpos
 dsend c,0x0,0x01  ;set ypos
 dsend f,0x0,0x06
 add b,1,b
 jmp [ploop1]

preset_x:
 mov b,0
 add c,1,c
 jmp [ploop0]

script:
;--[[COLORPALLET]]--
mov a,[Player0s]  ;sprite adress
mov b,0           ;x
mov c,0           ;y
mov d,0xF         ;width
mov e,[loop0done] ;output


;--1
mov h,177
dsend h,0x0,0x02
mov h, 52
dsend h,0x0,0x03
mov h, 37
dsend h,0x0,0x04
mov h,0x01
dsend h,0x0,0x05

;--2
mov h,227
dsend h,0x0,0x02
mov h,157
dsend h,0x0,0x03
mov h, 37
dsend h,0x0,0x04
mov h,0x02
dsend h,0x0,0x05

;--3
mov h,106
dsend h,0x0,0x02
mov h,107
dsend h,0x0,0x03
mov h,  4
dsend h,0x0,0x04
mov h,0x03
dsend h,0x0,0x05

;--[[render]]--
mov h,0xF ;height
loop0:
 cmpgt c,h
 raw 0x0B,0x64,0x00,0x00,0x00,0x00
 loop1:
  cmpgt b,d
  jmp [reset_x]
  
  dsend b,0x0,0x00  ;set xpos
  dsend c,0x0,0x01  ;set ypos
  mov g,0
  rrom g, a,f       ;read pixel
  split f,f,g       ;split it into lower and upper
  dsend f,0x0,0x06
  dsend c,0x0,0x01
  add b,1,b
  dsend b,0x0,0x00
  dsend g,0x0,0x06
  add b,1,b
  add a,1,a
;  dsend g,0x0,0x07  ;updating screen
  jmp [loop1]
 reset_x:
  mov b,0
  add c,1,c
  jmp [loop0]

loop0done:
 mov b,1

loop2:
 dsend g,0x0,0x07  ;updating screen
 drecv a,0x1,0x00  ;get controller0 input
 cmpeq a,b         ;if (A) is pressed...
 jmp [halt]        ;\true
 jmp [loop2]       ;\false 

halt:
 disp a
 hlt
