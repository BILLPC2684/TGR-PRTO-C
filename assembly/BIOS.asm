%NOCHECKSUM

jmp [start]

image:{
 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x11,0x11,0x10,0x11,0x10,0x00,0x00,
 0x22,0x22,0x20,0x20,0x02,0x02,0x22,0x20,0x00,0x00,0x00,0x00,0x01,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x00,0x00,
 0x00,0x30,0x00,0x30,0x03,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x11,0x11,0x11,0x41,0x14,0x11,0x11,0x11,0x14,0x00,
 0x00,0x30,0x00,0x33,0x33,0x03,0x33,0x00,0x00,0x00,0x00,0x01,0x14,0x11,0x11,0x11,0x11,0x11,0x14,0x11,0x11,0x10,
 0x00,0x20,0x00,0x20,0x02,0x02,0x00,0x00,0x00,0x00,0x00,0x01,0x11,0x11,0x41,0x11,0x11,0x11,0x11,0x11,0x11,0x11,
 0x00,0x30,0x00,0x30,0x03,0x03,0x33,0x30,0x00,0x00,0x00,0x00,0x11,0x11,0x11,0x14,0x44,0x44,0x41,0x11,0x14,0x14,
 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x11,0x44,0x44,0x44,0x44,0x44,0x41,0x41,0x11,
 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x14,0x44,0x44,0x44,0x44,0x44,0x44,0x11,0x41,
 0x02,0x22,0x00,0x02,0x22,0x00,0x20,0x00,0x20,0x22,0x22,0x00,0x11,0x44,0x44,0x44,0x44,0x55,0x54,0x44,0x11,0x11,
 0x30,0x00,0x30,0x30,0x00,0x30,0x33,0x03,0x30,0x30,0x00,0x00,0x11,0x44,0x46,0x55,0x55,0x57,0x64,0x44,0x11,0x10,
 0x30,0x00,0x00,0x30,0x00,0x30,0x30,0x30,0x30,0x33,0x30,0x00,0x01,0x44,0x46,0x55,0x77,0x76,0x44,0x44,0x41,0x00,
 0x30,0x03,0x30,0x33,0x33,0x30,0x30,0x00,0x30,0x30,0x00,0x00,0x00,0x14,0x67,0x77,0x77,0x64,0x44,0x44,0x41,0x00,
 0x20,0x00,0x20,0x20,0x00,0x20,0x20,0x00,0x20,0x20,0x00,0x00,0x00,0x00,0x67,0x77,0x56,0x66,0x66,0x44,0x41,0x10,
 0x03,0x33,0x00,0x30,0x00,0x30,0x30,0x00,0x30,0x33,0x33,0x00,0x00,0x06,0x77,0x55,0x55,0x55,0x64,0x11,0x11,0x10,
 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x66,0x65,0x55,0x56,0x40,0x00,0x41,0x00,
 0x22,0x22,0x00,0x02,0x22,0x00,0x22,0x22,0x20,0x22,0x22,0x02,0x22,0x20,0x00,0x65,0x55,0x60,0x00,0x00,0x00,0x00,
 0x30,0x00,0x30,0x30,0x00,0x30,0x00,0x03,0x30,0x30,0x00,0x03,0x00,0x03,0x06,0x55,0x76,0x00,0x00,0x00,0x00,0x00,
 0x30,0x00,0x30,0x30,0x00,0x30,0x00,0x33,0x00,0x33,0x30,0x03,0x00,0x03,0x06,0x77,0x60,0x00,0x00,0x00,0x00,0x00,
 0x33,0x33,0x00,0x33,0x33,0x30,0x03,0x30,0x00,0x30,0x00,0x03,0x33,0x30,0x67,0x76,0x00,0x00,0x00,0x00,0x00,0x00,
 0x20,0x20,0x00,0x20,0x00,0x20,0x22,0x00,0x00,0x20,0x00,0x02,0x02,0x00,0x65,0x60,0x00,0x00,0x00,0x00,0x00,0x00,
 0x30,0x03,0x00,0x30,0x00,0x30,0x33,0x33,0x30,0x33,0x33,0x03,0x00,0x36,0x56,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
}

;--[[Checks if the ROM is for TGR]]--
start:
 rrom a,0x000001
 cmpeq a,0x54
  jmp [continue1]
 hlt
continue1:
 rrom a,0x000002
 cmpeq a,0x47
  jmp [continue2]
 hlt
continue2:
 rrom a,0x000003
 cmpeq a,0x52
  jmp [main]
 hlt

main:
;--[[COLORPALLET]]--
mov a,[image]    ;sprite adress
mov b,60         ;X
mov c,96         ;Y

;--1
mov h,0x8c
dsend h,0x0,0x02
mov h,0x8c
dsend h,0x0,0x03
mov h,0x8c
dsend h,0x0,0x04
mov h,0x01
dsend h,0x0,0x05

;--2
mov h,0xff
dsend h,0x0,0x02
mov h,0x62
dsend h,0x0,0x03
mov h,0x62
dsend h,0x0,0x04
mov h,0x02
dsend h,0x0,0x05

;--3
mov h,0xff
dsend h,0x0,0x02
mov h,0x00
dsend h,0x0,0x03
mov h,0x00
dsend h,0x0,0x04
mov h,0x03
dsend h,0x0,0x05

;--4
mov h,0xac
dsend h,0x0,0x02
mov h,0xac
dsend h,0x0,0x03
mov h,0xac
dsend h,0x0,0x04
mov h,0x04
dsend h,0x0,0x05

;--5
mov h,0xf1
dsend h,0x0,0x02
mov h,0xdc
dsend h,0x0,0x03
mov h,0x69
dsend h,0x0,0x04
mov h,0x05
dsend h,0x0,0x05

;--6
mov h,0xcb
dsend h,0x0,0x02
mov h,0xae
dsend h,0x0,0x03
mov h,0x0c
dsend h,0x0,0x04
mov h,0x06
dsend h,0x0,0x05

;--7
mov h,0xff
dsend h,0x0,0x02
mov h,0xd8
dsend h,0x0,0x03
mov h,0x00
dsend h,0x0,0x04
mov h,0x07
dsend h,0x0,0x05

;--F
mov h,0x00
dsend h,0x0,0x02
mov h,0x00
dsend h,0x0,0x03
mov h,0x00
dsend h,0x0,0x04
mov h,0x0F
dsend h,0x0,0x05

jmp [loop0]

plot4x:
 mov h,0
 ploop:
  push h
  mov h,0
  ploop1:
   dsend b,0x0,0x00  ;set xpos
   dsend c,0x0,0x01  ;set ypos
   dsend f,0x0,0x06  ;plot
   inc c
   inc h
   cmplt h,8
    jmp [ploop1]
  pop h
  sub c,8,c
  inc b
  inc h
  cmplt h,8
   jmp [ploop]
 dsend g,0x0,0x07
 ret

loop0:
 mov h,264 ;height (21*8) 180+167
 mov d,398 ;width (43*8) / 412

 cmpgt c,h
  jmp [loop0done]
 loop1:
  cmpgt b,d
  jmp [reset_x]
  
  mov g,0
  rbios g,a,f       ;read pixel
  split f,g,f,1     ;split it into lower and upper
  call [plot4x]
  mov g,f
  call [plot4x]
;  sub b,1,b
  dsend g,0x0,0x06
;  add b,1,b
  add a,1,a
  jmp [loop1]
 
 reset_x:
  mov b,60
  add c,8,c
  jmp [loop0]

;waiting...
loop0done:
mov b,1000
mov c,0
tloop:
 dsend e,0x0,0x07 ;render
 gclk a,0
 cmpgt a,b
  jmp [tick]
 jmp [tloop]
tick:
 gclk a,1
 inc c
 add b,1000,b
 cmplt c,4
  jmp [tloop]

mov d,0
mov c,0
mov f,0xF
drecv d,0x0,0x00 ;width
drecv h,0x0,0x01 ;height
cloop0:
 cmpgt c,h
 jmp [launch]
cloop1:
 cmpgt b,d
 jmp [creset_x]
 
 dsend b,0x0,0x00  ;set xpos
 dsend c,0x0,0x01  ;set ypos
 dsend f,0x0,0x06
 add b,1,b
 jmp [cloop1]

creset_x:
 dsend g,0x0,0x07 ;updating screen
 mov b,0
 add c,1,c
 jmp [cloop0]

;find TGR at the start of a ROM
launch:
 mov a,0
 mov b,0
 mov c,0
 mov d,0
 mov e,0
 mov f,0
 mov g,0
 rrom h,0x000000
 cmpeq g,h
  jmp [launch0]
 jmp [launch1]

launch0:
 mov h,0
 exec 1,0x4
 
launch1:
 mov h,0
 exec 1,0xc ;8 letter name

;ROM Header:
; 0\type
; 1\T
; 2\G
; 3\R
; 4\T0
; 5\T1
; 6\T2
; 7\T3
; 8\T4
; 9\T5
;10\T6
;11\T7
